---
title: "1-DataAnalysis"
author: "Arlie McCarthy"
date: "02/05/2021"
output: html_document
---
# Code Setup and Data Import

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(vegan)
library(tidyverse)
library(readr)
```

I have one data file with the count data from lab processing. The file needs some wrangling to calculate a density (counts per cm2) for each quadrat sampled.

```{r calculating density}
taxon_count_data <- read_csv("data/taxon_count_data_internal_pipework.csv")
taxon_density <- taxon_count_data %>% 
  mutate(id = paste(area, quadrat_number)) %>% #some quadrats had multiple 'sample' so changed to just area and quadrat
  group_by(id, taxon, taxon_grouping_qualifier) %>% 
  mutate(density = count*multiply_by/divide_by/area_sampled*100) %>% #counts per m2
  summarise(avg_density = mean(density))
```

# Preparing Data for ordination

I take my data from counts to a community matrix, with species as variables and rows as samples

```{r nMDS preparation}
community_matrix <- taxon_density %>% 
  group_by(id) %>% 
  mutate(full_taxon_group = paste(taxon, taxon_grouping_qualifier)) %>% 
  select(id, full_taxon_group, avg_density) %>% 
  pivot_wider(names_from = full_taxon_group, values_from = avg_density) %>% 
  ungroup() %>% 
  column_to_rownames(var = "id")
community_matrix[is.na(community_matrix)] <- 0
community_matrix <- community_matrix %>% 
  filter_all(any_vars(. != 0))
```

## nMDS

```{r nMDS}
internal_pipe_nmds <- metaMDS(community_matrix, k = 2)
plot(internal_pipe_nmds, type = "t")
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
